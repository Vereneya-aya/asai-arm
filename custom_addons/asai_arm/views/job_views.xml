<?xml version="1.0" encoding="UTF-8"?>
<odoo>

    <!-- Список -->
    <record id="view_asai_job_list" model="ir.ui.view">
        <field name="name">asai.job.list</field>
        <field name="model">asai.job</field>
        <field name="arch" type="xml">
            <list string="Задания"
                  decoration-info="status == 'ready'"
                  decoration-warning="status == 'in_progress'"
                  decoration-success="status == 'done'"
                  decoration-danger="status == 'scrap'"
                  decoration-muted="status == 'blocked'">
                <field name="name" string="Имя"/>
                <field name="stage"/>
                <field name="priority"/>
                <field name="status"/>
                <field name="start_time"/>
                <field name="end_time"/>
                <field name="duration"/>
            </list>
        </field>
    </record>


    <!-- Форма с кнопками -->
    <record id="view_asai_job_form" model="ir.ui.view">
        <field name="name">asai.job.form</field>
        <field name="model">asai.job</field>
        <field name="arch" type="xml">
            <form string="Задание" create="false" edit="true" readonly="0">
                <sheet>
                    <group>
                        <field name="name" string="Имя"/>
                        <field name="stage"/>
                        <field name="priority"/>
                        <field name="status" widget="statusbar"
                               statusbar_visible="ready,in_progress,done,scrap,blocked"
                               statusbar_colors="in_progress:orange,done:green,scrap:red,blocked:purple"/>
                        <field name="operator_ids" widget="many2many_tags"/>
                        <field name="drawing_url"/>
                        <field name="start_time"/>
                        <field name="end_time"/>
                        <field name="duration" readonly="1"/>

                        <!-- Добавляем причину -->
                        <field name="reason"
                               modifiers='{"invisible": [["status","not in",["scrap","blocked"]]],
                       "required": [["status","in",["scrap","blocked"]]]}'/>
                    </group>
                </sheet>

                <!-- Кнопки -->
                <button name="action_take" type="object" string="Взять в работу" class="btn-primary"/>
                <button name="action_done" type="object" string="ГОТОВО" class="btn-success"/>
                <button name="action_scrap" type="object" string="БРАК" class="btn-danger"/>
                <button name="action_blocked" type="object" string="Невозможно" class="btn-secondary"/>
            </form>
        </field>
    </record>

    <!-- Поиск -->
    <record id="view_asai_job_search" model="ir.ui.view">
        <field name="name">asai.job.search</field>
        <field name="model">asai.job</field>
        <field name="arch" type="xml">
            <search string="Поиск заданий">
                <!-- Поля -->
                <field name="name"/>
                <field name="stage"/>
                <field name="status"/>

                <!-- Фильтры -->
                <filter name="all" string="Все задания" domain="[]"/>
                <filter name="ready" string="Готовы к работе" domain="[('status','=','ready')]"/>
                <filter name="done" string="Готово (выполнено)" domain="[('status','=','done')]"/>
                <filter name="in_progress" string="В работе" domain="[('status','=','in_progress')]"/>
                <filter name="mine" string="Мои" domain="['|',('operator_ids','=',uid),('status','=','ready')]"/>
                <filter name="not_done" string="Текущие" domain="[('status','!=','done')]"/>
                <!-- Группировка -->
                <group string="Группировать по">
                    <filter name="group_by_stage" string="Этап" context="{'group_by': 'stage'}"/>
                    <filter name="group_by_operator" string="Оператор" context="{'group_by': 'operator_ids'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Action -->
    <record id="action_asai_jobs" model="ir.actions.act_window">
        <field name="name">АРМ оператора</field>
        <field name="res_model">asai.job</field>
        <field name="view_mode">list,form</field>
    </record>

    <!-- Меню -->
    <menuitem id="menu_asai_root" name="АРМ оператора"/>
    <menuitem id="menu_asai_jobs" parent="menu_asai_root" action="action_asai_jobs" name="Задания"/>

</odoo>